<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NPC Backlog & Capacity Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f8fafc;
      margin: 0;
      padding: 24px;
      color: #0f172a;
    }
    h1 { margin-bottom: 20px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }
    .card {
      background: #ffffff;
      padding: 16px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }
    .card h3 {
      margin-top: 0;
      font-size: 14px;
      color: #475569;
    }
    .kpi {
      font-size: 26px;
      font-weight: bold;
    }
    label {
      font-size: 12px;
      display: block;
      margin-top: 8px;
    }
    input {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 6px;
      text-align: center;
      font-size: 13px;
    }
    th { background: #f1f5f9; }
    .pos { color: #16a34a; font-weight: bold; }
    .neg { color: #dc2626; font-weight: bold; }
  </style>
</head>

<body>

<h1>NPC Backlog & Capacity Dashboard</h1>

<!-- KPI -->
<div class="grid">
  <div class="card">
    <h3>Total Starting Backlog</h3>
    <div class="kpi" id="totalBacklog">0</div>
  </div>
  <div class="card">
    <h3>Monthly Capacity</h3>
    <div class="kpi" id="capacityKpi">225</div>
  </div>
  <div class="card">
    <h3>Projected Backlog (Jun)</h3>
    <div class="kpi" id="endBacklog">0</div>
  </div>
  <div class="card">
    <h3>Additional Dev FTE Needed</h3>
    <div class="kpi" id="addlDev">0</div>
  </div>
</div>

<br>

<!-- Inputs -->
<div class="grid">
  <div class="card">
    <h3>Backlog Inputs</h3>
    <label>Current Backlog</label>
    <input id="currentBacklog" type="number" value="545">
    <label>Future Inflow (6 months)</label>
    <input id="futureInflow" type="number" value="404">
  </div>

  <div class="card">
    <h3>Backlog Type</h3>
    <label>NPC (Firm)</label>
    <input id="npc" type="number" value="172">
    <label>Customer Dependency (Unfirm)</label>
    <input id="custDep" type="number" value="54">
    <label>Manual → Automation</label>
    <input id="m2a" type="number" value="113">
    <label>UDS → Plug</label>
    <input id="uds" type="number" value="206">
  </div>

  <div class="card">
    <h3>Capacity & FTE</h3>
    <label>Monthly Capacity</label>
    <input id="capacity" type="number" value="225">
    <label>Dev FTE</label>
    <input id="devFte" type="number" value="8">
    <label>QA FTE</label>
    <input id="qaFte" type="number" value="7">
  </div>
</div>

<br>

<!-- Monthly Simulation -->
<div class="card">
  <h3>Monthly Simulation</h3>
  <table id="simTable">
    <thead>
      <tr>
        <th>Month</th>
        <th>NPC</th>
        <th>Yardi</th>
        <th>Manual → Auto</th>
        <th>Prospect</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<br>

<!-- Dev / QA -->
<div class="card">
  <h3>Dev & QA FTE Capacity</h3>
  <div class="grid">
    <div>
      <strong>Dev</strong>
      <div>Hours Needed: <span id="devNeeded"></span></div>
      <div>Hours Available: <span id="devAvail"></span></div>
      <div>Surplus / Deficit: <span id="devSurplus"></span></div>
      <div><strong>Additional Dev FTE: <span id="addlDev2"></span></strong></div>
    </div>
    <div>
      <strong>QA</strong>
      <div>Hours Needed: <span id="qaNeeded"></span></div>
      <div>Hours Available: <span id="qaAvail"></span></div>
      <div>Surplus / Deficit: <span id="qaSurplus"></span></div>
      <div><strong>Additional QA FTE: <span id="addlQa"></span></strong></div>
    </div>
  </div>
</div>

<br>

<!-- Chart -->
<div class="card">
  <h3>6-Month Backlog Forecast</h3>
  <canvas id="forecastChart" height="120"></canvas>
</div>

<script>
  const months = ["Jan","Feb","Mar","Apr","May","Jun"];
  const simDefaults = { npc:110, yardi:34, m2a:20, prospect:67 };

  const tbody = document.querySelector("#simTable tbody");

  months.forEach(m => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${m}</td>
      <td><input value="${simDefaults.npc}"></td>
      <td><input value="${simDefaults.yardi}"></td>
      <td><input value="${simDefaults.m2a}"></td>
      <td><input value="${simDefaults.prospect}"></td>
      <td class="total">0</td>`;
    tbody.appendChild(tr);
  });

  const chart = new Chart(document.getElementById("forecastChart"), {
    type: "line",
    data: { labels: months, datasets: [
      { label:"Start Backlog", data:[], borderColor:"#0f172a" },
      { label:"Capacity", data:[], borderColor:"#16a34a" }
    ]}
  });

  function recalc() {
    const cur = +currentBacklog.value;
    const inflow = +futureInflow.value;
    const cap = +capacity.value;

    const weightedUnfirm = +custDep.value * 0.6;
    totalBacklog.textContent =
      Math.round(+npc.value + weightedUnfirm + +m2a.value + +uds.value);

    capacityKpi.textContent = cap;

    let start = cur;
    const sArr=[], cArr=[];
    for (let i=0;i<6;i++){
      sArr.push(start);
      cArr.push(cap);
      start = Math.max(0, start + inflow/6 - cap);
    }
    endBacklog.textContent = Math.round(start);

    chart.data.datasets[0].data = sArr;
    chart.data.datasets[1].data = cArr;
    chart.update();

    let monthlyTickets = 0;
    document.querySelectorAll("#simTable tbody tr").forEach(r=>{
      let t=0;
      r.querySelectorAll("input").forEach(i=>t+=+i.value);
      r.querySelector(".total").textContent=t;
      monthlyTickets += t;
    });
    monthlyTickets /= 6;

    const DEV_HRS = 8.9, QA_HRS = 7.8, HRS = 160;

    const devNeed = Math.round(monthlyTickets * DEV_HRS);
    const qaNeed  = Math.round(monthlyTickets * QA_HRS);

    const devAvail = +devFte.value * HRS;
    const qaAvail  = +qaFte.value * HRS;

    devNeeded.textContent = devNeed;
    qaNeeded.textContent = qaNeed;
    devAvailEl.textContent = devAvail;
    qaAvailEl.textContent = qaAvail;

    const devSur = devAvail - devNeed;
    const qaSur  = qaAvail - qaNeed;

    devSurplus.textContent = devSur;
    devSurplus.className = devSur>=0?"pos":"neg";
    qaSurplus.textContent = qaSur;
    qaSurplus.className = qaSur>=0?"pos":"neg";

    const addDev = devSur>=0?0:Math.ceil(Math.abs(devSur)/HRS);
    const addQa  = qaSur>=0?0:Math.ceil(Math.abs(qaSur)/HRS);

    addlDev.textContent = addDev;
    addlDev2.textContent = addDev;
    addlQa.textContent = addQa;
  }

  const devAvailEl = document.getElementById("devAvail");
  const qaAvailEl = document.getElementById("qaAvail");

  document.querySelectorAll("input").forEach(i=>i.addEventListener("input",recalc));
  recalc();
</script>

</body>
</html>
